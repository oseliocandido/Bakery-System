<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bakery Avenida</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>
  <nav>
    <h1>Funcionários</h1>
    <ul>
        <li><a href="#show"   onclick="showSection('all-employees')">Funcionários</a></li>
        <li><a href="#create" onclick="showSection('createUser')">Cadastrar</a></li>
        <li><a href="#update" onclick="showSection('updateUser')">Atualizar</a></li>
    </ul>
  </nav>
  <div id="all-employees" class="section">
    <ul>
      <!-- Header Row with Field Names -->
      <li class="header">
        <div><strong>Numero de Identificação</strong></div>
        <div><strong>Nome</strong></div>
        <div><strong>Data de Nascimento</strong></div>
        <div><strong>Data de Admissão</strong></div>
        <div><strong>Cargo</strong></div>
        <div><strong>Telefone</strong></div>
        <div><strong>Observação</strong></div>
        <div><strong>Status</strong></div>
      </li>
    
      <!-- User Row 1 -->
      <li>
        <div>12345</div>
        <div>John Doe</div>
        <div>1990-01-01</div>
        <div>2015-01-01</div>
        <div>Manager</div>
        <div>123-456-7890</div>
        <div>Regular employee</div>
        <div><span class="status-box active">Active</span></div>
      </li>
    
      <!-- User Row 2 -->
      <li>
        <div>12346</div>
        <div>Jane Smith</div>
        <div>1992-02-01</div>
        <div>2018-03-01</div>
        <div>Atendente</div>
        <div>234-567-8901</div>
        <div>Excellent performance</div>
        <div><span class="status-box inactive">Inactive</span></div>
      </li>
    
      <!-- Additional user rows can follow the same structure -->
    </ul>
    
  </div>
  

  <div id="createUser" class="section container-create-user" style="display: none">
    <form class="user-form">
      <label for="name">Nome</label>
      <input type="text" id="name" placeholder="Nome" required>
      <label for="role">Cargo</label>
      <select id="role" name="options">
        <option value="Option 1">Atendente</option>
        <option value="Option 2" selected>Caixa</option>
        <option value="Option 3">Cozinheiro</option>
      </select>
      <label for="dob">Data de Admissão</label>
      <input type="date" id="dob" required>
      <label for="doa">Data de Nascimento</label> <!-- Fixed duplicate label issue -->
      <input type="date" id="doa" required>
      <label for="telephone">Telefone</label>
      <input type="text" id="telephone" placeholder="(XX) XXXXX-XXXX" required>
      <label for="observation">Observação</label>
      <input type="text" id="observation">
      <button type="submit">Create User</button>
    </form>
  </div>

  <div id="updateUser" class="section container-create-user" style="display: none">
    <form class="user-form" onsubmit="updateUser(event)">
      <label for="update-numero_identificacao">Numero de Identificação</label>
      <select id="update-numero_identificacao" onchange="handleUserSelection()">
        <option value="">Selecione um usuário</option>
      </select>
      <label for="update-name">Nome</label>
      <input type="text" id="update-name" placeholder="" required>
      <label for="update-role">Cargo</label>
      <select id="update-role" name="update-role">
        <option value="Auxiliar de Padeiro">Auxiliar de Padeiro</option>
        <option value="Atendente de Caixa">Atendente de Caixa</option>
        <option value="Cozinheiro">Cozinheiro</option>
        <option value="Padeiro">Padeiro</option>
      </select>
      <label for="update-dob">Data de Admissão</label>
      <input type="date" id="update-dob" required>
      <label for="update-doa">Data de Nascimento</label>
      <input type="date" id="update-doa" required>
      <label for="update-telephone">Telefone</label>
      <input type="text" id="update-telephone" placeholder="" required>
      <label for="update-observation">Observação</label>
      <input type="text" id="update-observation" placeholder="">
      <button type="submit" onsubmit="">Update User</button>
    </form>
  </div>

<script>
    let employees = [];

    async function fetchEmployees() {
        const response = await fetch('http://localhost:4200/api/users');
        employees = await response.json();
        
        const selectElement = document.getElementById("update-numero_identificacao");

        // Clear previous options (except the default one)
        selectElement.innerHTML = `<option value="">Selecione um usuário</option>`;

        // Populate dropdown
        employees.forEach(user => {
            const option = document.createElement("option");
            option.value = user.numero_identificacao;
            option.textContent = user.numero_identificacao;
            selectElement.appendChild(option);
        });
    }

    function handleUserSelection() {
        const selectedId = document.getElementById("update-numero_identificacao").value;
        if (!selectedId) return;

        const user = employees.find(emp => emp.numero_identificacao == selectedId);
        if (user) {
            document.getElementById("update-name").value = user.complete_name;
            document.getElementById("update-dob").value = user.date_admissao.split('T')[0];
            document.getElementById("update-doa").value = user.date_nascimento.split('T')[0];
            document.getElementById("update-telephone").value = user.telephone_number;
            document.getElementById("update-observation").value = user.observation || "";

             // Directly set the value of the role select dropdown
            document.getElementById("update-role").value = user.role;
        }
    }

    // Fetch employees on page load
    fetchEmployees();




    async function updateUser(event) {
    event.preventDefault(); // Prevent form from submitting normally

    const selectedId = document.getElementById("update-numero_identificacao").value;
    if (!selectedId) {
        alert("Por favor, selecione um usuário para atualizar.");
        return;
    }

    const dateAdmissao = document.getElementById("update-dob").value;
    const dateNascimento = document.getElementById("update-doa").value;

    // Ensure the date format is correct (ISO 8601 format with time set to 00:00:00)
    const formattedDateAdmissao = `${dateAdmissao}T00:00:00`;
    const formattedDateNascimento = `${dateNascimento}T00:00:00`;

    const updatedUser = {
        numero_identificacao: selectedId,
        complete_name: document.getElementById("update-name").value,
        role: document.getElementById("update-role").value,
        date_admissao: formattedDateAdmissao,
        date_nascimento: formattedDateNascimento,
        telephone_number: document.getElementById("update-telephone").value,
        observation: document.getElementById("update-observation").value,
        status: "Ativo"
    };
   
    try {
        const response = await fetch(`http://localhost:4200/api/users/${selectedId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(updatedUser)
        });

        if (response.ok) {
            alert("Usuário atualizado com sucesso!");
            fetchEmployees(); // Refresh the user list
        } else {
            alert("Erro ao atualizar usuário.");
        }
    } catch (error) {
        console.error("Erro ao atualizar usuário:", error);
        alert("Falha na atualização do usuário.");
    }
}

</script>




  <script>

    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById(sectionId).style.display = 'block';
    }
  </script>


</body>
</html>
